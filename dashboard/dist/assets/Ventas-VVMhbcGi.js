import{r,A as d,j as a}from"./index-CtDtNwU0.js";import{a as S}from"./index-NIGUFBhG.js";import{f as J,a as K}from"./dateUtils-Bol1tabJ.js";function Z(){const[l,T]=r.useState([]),[_,F]=r.useState([]),[g,$]=r.useState(""),[u,L]=r.useState(""),[h,P]=r.useState(""),[m,A]=r.useState(""),[b,B]=r.useState(""),[x,U]=r.useState(""),[p,q]=r.useState(""),[f,I]=r.useState(""),[o,y]=r.useState(1),[W,j]=r.useState(!1),[w,D]=r.useState(0),[C,M]=r.useState(""),R=1e3,c=r.useRef(null),i=r.useRef(null),v=r.useRef(null),k=r.useCallback((e,t=16)=>(...s)=>{v.current||(v.current=requestAnimationFrame(()=>{e(...s),v.current=null}))},[]),O=k(e=>{i.current&&!i.current.isScrolling&&(i.current.scrollLeft=e.target.scrollLeft)}),z=k(e=>{c.current&&!c.current.isScrolling&&(c.current.scrollLeft=e.target.scrollLeft)});r.useEffect(()=>{V(),E()},[o]),r.useEffect(()=>{S.get(`${d}/ventas/ultima-fecha`).then(e=>M(J(e.data.fecha))).catch(()=>M(""))},[]);const V=async()=>{try{const e=await S.get(`${d}/sucursales`);F(e.data)}catch(e){console.error("Error al obtener sucursales",e)}},E=async()=>{try{j(!0);const e=await S.get(`${d}/ventas`,{params:{cliente:g,sucursal:u,fecha_inicio:h,fecha_fin:m,monto_min:b,monto_max:x,tarjeta:p,terminacion:f,pagina:o,limite:R}});T(e.data.datos.map(K)),D(e.data.total),j(!1)}catch{j(!1)}},G=()=>{const e=new URLSearchParams({cliente:g,sucursal:u,fecha_inicio:h,fecha_fin:m,monto_min:b,monto_max:x,tarjeta:p,terminacion:f});window.location.href=`${d}/ventas/exportar?${e.toString()}`},n=l.length>0?Object.keys(l[0]):[],N=Math.max(1,Math.ceil(w/R));return a.jsx("div",{className:"p-6 min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:a.jsxs("div",{className:"backdrop-blur-lg bg-white/10 rounded-xl shadow-2xl p-6 max-w-full mx-2 md:mx-8 border border-white/20",children:[a.jsx("div",{className:"flex justify-between mb-4",children:a.jsx("h1",{className:"text-2xl font-bold mb-4 text-center text-gray-100 drop-shadow",children:"🔍 Buscador Reporte de Prevencion"})}),a.jsxs("span",{className:"text-sm text-gray-300 font-semibold",children:["Última actualización en base de datos:"," ",C?C.slice(0,10):"Sin registros"]}),a.jsx("div",{className:"bg-gray-800/30 backdrop-blur-sm border border-gray-700 rounded-lg p-4 mb-6",children:a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-2",children:[a.jsx("input",{type:"text",placeholder:"Buscar cliente...",className:"border border-gray-700 bg-gray-900/60 text-gray-100 placeholder-gray-400 p-2 rounded focus:ring-2 focus:ring-blue-500",value:g,onChange:e=>$(e.target.value)}),a.jsxs("select",{className:"border border-gray-700 bg-gray-900/60 text-gray-100 p-2 rounded focus:ring-2 focus:ring-blue-500",value:u,onChange:e=>L(e.target.value),children:[a.jsx("option",{value:"",children:"Todas las sucursales"}),_.map((e,t)=>a.jsx("option",{value:e,children:e},t))]}),a.jsx("input",{type:"date",className:"border border-gray-700 bg-gray-900/60 text-gray-100 p-2 rounded focus:ring-2 focus:ring-blue-500",value:h,onChange:e=>P(e.target.value)}),a.jsx("input",{type:"date",className:"border border-gray-700 bg-gray-900/60 text-gray-100 p-2 rounded focus:ring-2 focus:ring-blue-500",value:m,onChange:e=>A(e.target.value)}),a.jsx("input",{type:"number",placeholder:"Monto mínimo",className:"border border-gray-700 bg-gray-900/60 text-gray-100 placeholder-gray-400 p-2 rounded focus:ring-2 focus:ring-blue-500",value:b,onChange:e=>B(e.target.value)}),a.jsx("input",{type:"number",placeholder:"Monto máximo",className:"border border-gray-700 bg-gray-900/60 text-gray-100 placeholder-gray-400 p-2 rounded focus:ring-2 focus:ring-blue-500",value:x,onChange:e=>U(e.target.value)}),a.jsx("input",{type:"text",placeholder:"Número tarjeta",className:"border border-gray-700 bg-gray-900/60 text-gray-100 placeholder-gray-400 p-2 rounded focus:ring-2 focus:ring-blue-500",value:p,onChange:e=>q(e.target.value)}),a.jsx("input",{type:"text",placeholder:"Terminación tarjeta",className:"border border-gray-700 bg-gray-900/60 text-gray-100 placeholder-gray-400 p-2 rounded focus:ring-2 focus:ring-blue-500",value:f,onChange:e=>I(e.target.value)})]})}),a.jsxs("div",{className:"flex gap-4 mb-6",children:[a.jsx("button",{onClick:()=>{y(1),E()},className:"bg-gradient-to-r from-blue-600 to-blue-400 hover:from-blue-700 hover:to-blue-500 text-white px-6 py-2 rounded-lg font-semibold shadow-lg transition-all duration-300",children:"🔍 Buscar"}),a.jsx("button",{onClick:G,className:"bg-gradient-to-r from-green-600 to-green-400 hover:from-green-700 hover:to-green-500 text-white px-6 py-2 rounded-lg font-semibold shadow-lg transition-all duration-300",children:"📥 Exportar a Excel"})]}),a.jsxs("div",{className:"bg-gray-800/30 backdrop-blur-sm border border-gray-700 rounded-lg overflow-hidden w-full",children:[a.jsx("div",{ref:c,className:"overflow-x-auto mb-2 bg-gray-700/50 p-1 rounded",onScroll:O,style:{scrollbarWidth:"thin"},children:a.jsx("div",{style:{width:`${Math.max(1200,n.length*300)}px`,height:"12px",background:"linear-gradient(90deg, rgba(59, 130, 246, 0.3) 0%, rgba(147, 51, 234, 0.3) 100%)",borderRadius:"6px"}})}),a.jsx("div",{ref:i,className:"overflow-x-auto table-container",onScroll:z,style:{scrollbarWidth:"thin"},children:W?a.jsx("div",{className:"p-8 text-center",children:a.jsx("div",{className:"text-gray-400 text-lg",children:"Cargando..."})}):a.jsxs("table",{className:"w-full text-sm",style:{minWidth:`${Math.max(1200,n.length*120)}px`},children:[a.jsx("thead",{children:a.jsx("tr",{className:"bg-gray-700/50 text-left",children:n.map((e,t)=>a.jsx("th",{className:"p-3 font-semibold text-gray-200 whitespace-nowrap border-r border-gray-600/30 last:border-r-0",children:e},t))})}),a.jsx("tbody",{children:l.length>0?l.map((e,t)=>a.jsx("tr",{className:"border-b border-gray-700/30 hover:bg-gray-700/30 transition-colors",children:n.map((s,H)=>a.jsx("td",{className:"p-3 text-gray-300 whitespace-nowrap border-r border-gray-600/20 last:border-r-0",children:s==="FechaCompra"&&e[s]?e[s].slice(0,10):e[s]?.toString()},H))},t)):a.jsx("tr",{children:a.jsx("td",{colSpan:n.length,className:"text-center p-8 text-gray-500",children:"No hay resultados para mostrar"})})})]})})]}),a.jsxs("div",{className:"flex justify-center items-center gap-4 mt-6",children:[a.jsx("button",{onClick:()=>y(e=>Math.max(e-1,1)),className:"bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg text-white transition disabled:opacity-50",disabled:o===1,children:"← Anterior"}),a.jsxs("span",{className:"text-gray-300 font-medium",children:["Página ",o," de ",N," | Total: ",w," registros"]}),a.jsx("button",{onClick:()=>y(e=>Math.min(e+1,N)),className:"bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg text-white transition disabled:opacity-50",disabled:o===N,children:"Siguiente →"})]})]})})}export{Z as default};
