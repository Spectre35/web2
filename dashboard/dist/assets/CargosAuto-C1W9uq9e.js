import{r as s,u as ie,A as o,j as a,L as de}from"./index-CtDtNwU0.js";import{a as n}from"./index-NIGUFBhG.js";import{f as _,a as ue}from"./dateUtils-Bol1tabJ.js";function xe(){const[d,B]=s.useState([]),[O,U]=s.useState([]),[z,E]=s.useState([]),[u,D]=s.useState(""),[g,I]=s.useState(""),[m,q]=s.useState(""),[h,V]=s.useState(""),[x,G]=s.useState(""),[p,H]=s.useState(""),[b,J]=s.useState(""),[f,K]=s.useState(""),[l,Q]=s.useState([]),[c,N]=s.useState(1),[W,v]=s.useState(!1),[P,X]=s.useState(0),[Y,k]=s.useState(""),[A,Z]=s.useState([]),[ee,M]=s.useState(!0),[y,ae]=s.useState([]),[se,$]=s.useState(!0),[te,L]=s.useState(!1),S=s.useRef(null),R=1e3,T=ie();s.useEffect(()=>{re(),oe(),F()},[c]),s.useEffect(()=>{n.get(`${o}/cargos_auto/ultima-fecha`).then(e=>k(_(e.data.fecha))).catch(()=>k(""))},[]),s.useEffect(()=>{n.get(`${o}/cargos_auto/procesadores-alerta`).then(e=>{Z(e.data),M(e.data.length>0)}).catch(e=>{console.error("Error al obtener alertas",e)})},[]),s.useEffect(()=>{n.get(`${o}/sucursales-alerta`).then(e=>{ae(e.data),$(e.data.length>0)}).catch(e=>{console.error("Error al obtener alertas de sucursales",e)})},[]);const re=async()=>{try{const e=await n.get(`${o}/sucursales`);U(e.data)}catch(e){console.error("Error al obtener sucursales",e)}},oe=async()=>{try{const e=await n.get(`${o}/cargos_auto/procesadores`);E(e.data.filter(Boolean).map(t=>t.trim()).sort((t,r)=>t.localeCompare(r,"es",{sensitivity:"base"})))}catch{E([])}},F=async()=>{try{v(!0);const e=await n.get(`${o}/cargos_auto`,{params:{cliente:u,sucursal:g,fecha_inicio:m,fecha_fin:h,monto_min:x,monto_max:p,tarjeta:b,terminacion:f,procesadores:l,pagina:c,limite:R},paramsSerializer:t=>{const r=new URLSearchParams;return Object.entries(t).forEach(([j,i])=>{Array.isArray(i)?i.forEach(ce=>r.append(j,ce)):i!==void 0&&i!==""&&r.append(j,i)}),r.toString()}});B(e.data.datos.map(ue)),X(e.data.total),v(!1),T?.current&&(T.current.scrollTop=0)}catch(e){v(!1),console.error("Error al obtener datos:",e)}},ne=()=>{const e=new URLSearchParams;u&&e.append("cliente",u),g&&e.append("sucursal",g),m&&e.append("fecha_inicio",m),h&&e.append("fecha_fin",h),x&&e.append("monto_min",x),p&&e.append("monto_max",p),b&&e.append("tarjeta",b),f&&e.append("terminacion",f),l.forEach(t=>e.append("procesadores",t)),window.location.href=`${o}/cargos_auto/exportar?${e.toString()}`},w=d.length>0?Object.keys(d[0]):[],C=Math.max(1,Math.ceil(P/R));s.useEffect(()=>{const e=t=>{S.current&&!S.current.contains(t.target)&&L(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const le=e=>{Q(t=>t.includes(e)?t.filter(r=>r!==e):[...t,e])};return a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 p-6",children:[a.jsx("div",{className:"flex justify-between items-center mb-6",children:a.jsx("h1",{className:"text-3xl font-bold text-gray-100",children:"🔍 Buscador Cargos Auto"})}),a.jsx("div",{className:"mb-6",children:a.jsxs("span",{className:"text-sm text-gray-300 font-semibold",children:["Última actualización en base de datos:"," ",Y||"Sin registros"]})}),a.jsx("div",{className:"bg-gray-800/50 p-4 rounded-lg mb-6 backdrop-blur-sm",children:a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-2",children:[a.jsx("input",{type:"text",placeholder:"Buscar cliente...",className:"border border-gray-700 bg-gray-900/60 text-gray-100 placeholder-gray-400 p-2 rounded focus:ring-2 focus:ring-blue-500",value:u,onChange:e=>D(e.target.value)}),a.jsxs("select",{className:"border border-gray-700 bg-gray-900/60 text-gray-100 p-2 rounded focus:ring-2 focus:ring-blue-500",value:g,onChange:e=>I(e.target.value),children:[a.jsx("option",{value:"",children:"Todas las sucursales"}),O.map((e,t)=>a.jsx("option",{value:e,children:e},t))]}),a.jsx("input",{type:"date",className:"border border-gray-700 bg-gray-900/60 text-gray-100 p-2 rounded focus:ring-2 focus:ring-blue-500",value:m,onChange:e=>q(e.target.value)}),a.jsx("input",{type:"date",className:"border border-gray-700 bg-gray-900/60 text-gray-100 p-2 rounded focus:ring-2 focus:ring-blue-500",value:h,onChange:e=>V(e.target.value)}),a.jsx("input",{type:"number",placeholder:"Monto mínimo",className:"border border-gray-700 bg-gray-900/60 text-gray-100 placeholder-gray-400 p-2 rounded focus:ring-2 focus:ring-blue-500",value:x,onChange:e=>G(e.target.value)}),a.jsx("input",{type:"number",placeholder:"Monto máximo",className:"border border-gray-700 bg-gray-900/60 text-gray-100 placeholder-gray-400 p-2 rounded focus:ring-2 focus:ring-blue-500",value:p,onChange:e=>H(e.target.value)}),a.jsxs("div",{className:"relative",ref:S,children:[a.jsxs("button",{type:"button",className:"border border-gray-700 bg-gray-900/60 text-gray-100 p-2 rounded w-full text-left",onClick:()=>L(e=>!e),children:[l.length>0?`Procesadores (${l.length})`:"Selecciona procesadores",a.jsx("span",{className:"float-right",children:"▼"})]}),te&&a.jsx("div",{className:"absolute z-10 mt-1 w-full max-h-40 overflow-auto bg-gray-900 border border-gray-700 rounded shadow-lg",children:z.map((e,t)=>a.jsxs("label",{className:"flex items-center px-2 py-1 hover:bg-gray-800 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:l.includes(e),onChange:()=>le(e),className:"mr-2 accent-blue-500"}),a.jsx("span",{className:"text-gray-100",children:e})]},t))})]}),a.jsx("input",{type:"text",placeholder:"Número tarjeta",className:"border border-gray-700 bg-gray-900/60 text-gray-100 placeholder-gray-400 p-2 rounded focus:ring-2 focus:ring-blue-500",value:b,onChange:e=>J(e.target.value)}),a.jsx("input",{type:"text",placeholder:"Terminación tarjeta",className:"border border-gray-700 bg-gray-900/60 text-gray-100 placeholder-gray-400 p-2 rounded focus:ring-2 focus:ring-blue-500",value:f,onChange:e=>K(e.target.value)})]})}),a.jsxs("div",{className:"flex gap-4 mb-6",children:[a.jsx("button",{onClick:()=>{N(1),F()},className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition font-semibold",children:"🔍 Buscar"}),a.jsx("button",{onClick:ne,className:"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition font-semibold",children:"📥 Exportar a Excel"})]}),a.jsx("div",{className:"bg-gray-800/30 backdrop-blur-sm border border-gray-700 rounded-lg overflow-hidden",children:a.jsx("div",{className:"overflow-x-auto",children:W?a.jsx("div",{className:"p-8 text-center",children:a.jsx("div",{className:"text-gray-400 text-lg",children:"Cargando..."})}):a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{children:a.jsx("tr",{className:"bg-gray-700/50 text-left",children:w.map((e,t)=>a.jsx("th",{className:"p-3 font-semibold text-gray-200",children:e},t))})}),a.jsx("tbody",{children:d.length>0?d.map((e,t)=>a.jsx("tr",{className:"border-b border-gray-700/50 hover:bg-gray-700/30 transition-colors",children:w.map((r,j)=>a.jsx("td",{className:"p-3 text-gray-300",children:e[r]?.toString()},j))},t)):a.jsx("tr",{children:a.jsx("td",{colSpan:w.length,className:"text-center p-8 text-gray-500",children:"No hay resultados para mostrar"})})})]})})}),a.jsxs("div",{className:"flex justify-center items-center gap-4 mt-6",children:[a.jsx("button",{onClick:()=>N(e=>Math.max(e-1,1)),className:"bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg text-white transition disabled:opacity-50",disabled:c===1,children:"← Anterior"}),a.jsxs("span",{className:"text-gray-300 font-medium",children:["Página ",c," de ",C," | Total: ",P," registros"]}),a.jsx("button",{onClick:()=>N(e=>Math.min(e+1,C)),className:"bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg text-white transition disabled:opacity-50",disabled:c===C,children:"Siguiente →"})]}),a.jsxs("div",{className:"fixed bottom-4 right-4 z-50 space-y-3 max-w-sm",children:[se&&y.length>0&&a.jsxs("div",{className:"bg-orange-700/95 text-white p-4 rounded-lg shadow-xl font-medium",children:[a.jsxs("div",{className:"flex justify-between items-start mb-2",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("span",{className:"mr-2",children:"🏢"}),a.jsx("span",{className:"font-semibold text-sm",children:"Sucursales sin cobros:"})]}),a.jsx("button",{className:"ml-2 text-white/80 hover:text-white bg-orange-800 rounded-full px-2 py-1 hover:bg-orange-700 transition text-xs",onClick:()=>$(!1),title:"Cerrar alerta",children:"✕"})]}),a.jsxs("ul",{className:"mt-2 space-y-1 text-sm",children:[y.slice(0,5).map((e,t)=>a.jsxs("li",{className:"flex items-center",children:[a.jsx("span",{className:"w-2 h-2 bg-orange-400 rounded-full mr-2 flex-shrink-0"}),a.jsxs("span",{children:[a.jsxs("strong",{children:[e.Sucursal,":"]})," ",e.diasSinActividad," día(s) sin cobros",e.ultima_fecha&&a.jsxs("span",{className:"text-orange-200 ml-1",children:["(último: ",_(e.ultima_fecha),")"]})]})]},t)),y.length>5&&a.jsxs("li",{className:"text-orange-300 text-xs italic",children:["... y ",y.length-5," sucursales más"]})]}),a.jsx("div",{className:"mt-3 pt-2 border-t border-orange-600",children:a.jsx(de,{to:"/sucursales-alerta",className:"inline-flex items-center gap-2 bg-orange-600 hover:bg-orange-500 text-white px-3 py-2 rounded text-sm font-medium transition-colors",children:"📊 Ver Reporte Completo"})})]}),ee&&A.length>0&&a.jsxs("div",{className:"bg-red-700/95 text-white p-4 rounded-lg shadow-xl font-medium",children:[a.jsxs("div",{className:"flex justify-between items-start mb-2",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("span",{className:"mr-2",children:"⚠️"}),a.jsx("span",{className:"font-semibold text-sm",children:"Procesadores con baja actividad (2 días):"})]}),a.jsx("button",{className:"ml-2 text-white/80 hover:text-white bg-red-800 rounded-full px-2 py-1 hover:bg-red-700 transition text-xs",onClick:()=>M(!1),title:"Cerrar alerta",children:"✕"})]}),a.jsx("ul",{className:"mt-2 space-y-1 text-sm",children:A.map((e,t)=>a.jsxs("li",{className:"flex items-center",children:[a.jsx("span",{className:"w-2 h-2 bg-red-400 rounded-full mr-2 flex-shrink-0"}),a.jsxs("span",{children:[a.jsxs("strong",{children:[e.Cobrado_Por,":"]})," ",e.monto_total!==void 0?`$${Number(e.monto_total).toLocaleString()}`:"Sin datos",e.ultima_fecha&&a.jsxs("span",{className:"text-red-200 ml-1",children:["(última: ",_(e.ultima_fecha),")"]})]})]},t))})]})]})]})}export{xe as default};
