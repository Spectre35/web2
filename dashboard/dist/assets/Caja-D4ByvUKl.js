import{r as t,A as n,j as a}from"./index-CtDtNwU0.js";import{a as p}from"./index-NIGUFBhG.js";import{f as O,a as z}from"./dateUtils-Bol1tabJ.js";function V(){const[o,C]=t.useState([]),[M,_]=t.useState([]),[l,E]=t.useState(""),[c,F]=t.useState(""),[i,k]=t.useState(""),[d,T]=t.useState(""),[g,A]=t.useState(""),[u,P]=t.useState(""),[y,G]=t.useState(""),[f,H]=t.useState(""),[r,m]=t.useState(1),[B,h]=t.useState(!1),[j,$]=t.useState(0),[v,N]=t.useState(""),S=1e3;t.useEffect(()=>{D(),w()},[r]),t.useEffect(()=>{p.get(`${n}/caja/ultima-fecha`).then(e=>N(O(e.data.fecha))).catch(()=>N(""))},[]);const D=async()=>{try{const e=await p.get(`${n}/sucursales`);_(e.data)}catch(e){console.error("Error al obtener sucursales",e)}},w=async()=>{try{h(!0);const e=await p.get(`${n}/caja`,{params:{cliente:l,sucursal:c,fecha_inicio:i,fecha_fin:d,monto_min:g,monto_max:u,tarjeta:y,terminacion:f,pagina:r,limite:S}});C(e.data.datos.map(z)),$(e.data.total),h(!1)}catch{h(!1)}},R=()=>{const e=new URLSearchParams({cliente:l,sucursal:c,fecha_inicio:i,fecha_fin:d,monto_min:g,monto_max:u,tarjeta:y,terminacion:f});window.location.href=`${n}/caja/exportar?${e.toString()}`},U=["id","Cliente","Fecha","TipoComprobante","Cobro","Total","Concepto","Sucursal","FolioRecibo","es_euroskin_str","FormaPago","AplicadoA","Terminal"],I=o.length>0?Object.keys(o[0]):[],x=U.filter(e=>I.includes(e)),b=Math.max(1,Math.ceil(j/S));return a.jsx("div",{className:"p-6 min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:a.jsxs("div",{className:"backdrop-blur-lg bg-white/10 rounded-xl shadow-2xl p-6 max-w-full mx-2 md:mx-8 border border-white/20",children:[a.jsx("div",{className:"flex justify-between mb-4",children:a.jsx("h1",{className:"text-2xl font-bold mb-4 text-center text-gray-100 drop-shadow",children:"💵 Buscador Caja"})}),a.jsxs("span",{className:"text-sm text-gray-300 font-semibold",children:["Última actualización en base de datos:"," ",v?v.slice(0,10):"Sin registros"]}),a.jsx("div",{className:"bg-gray-800/30 backdrop-blur-sm border border-gray-700 rounded-lg p-4 mb-6",children:a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2",children:[a.jsx("input",{type:"text",placeholder:"Buscar cliente...",className:"border border-gray-700 bg-gray-900/60 text-gray-100 placeholder-gray-400 p-2 rounded focus:ring-2 focus:ring-blue-500",value:l,onChange:e=>E(e.target.value)}),a.jsxs("select",{className:"border border-gray-700 bg-gray-900/60 text-gray-100 p-2 rounded focus:ring-2 focus:ring-blue-500",value:c,onChange:e=>F(e.target.value),children:[a.jsx("option",{value:"",children:"Todas las sucursales"}),M.map((e,s)=>a.jsx("option",{value:e,children:e},s))]}),a.jsx("input",{type:"date",className:"border border-gray-700 bg-gray-900/60 text-gray-100 p-2 rounded focus:ring-2 focus:ring-blue-500",value:i,onChange:e=>k(e.target.value)}),a.jsx("input",{type:"date",className:"border border-gray-700 bg-gray-900/60 text-gray-100 p-2 rounded focus:ring-2 focus:ring-blue-500",value:d,onChange:e=>T(e.target.value)}),a.jsx("input",{type:"number",placeholder:"Monto mínimo",className:"border border-gray-700 bg-gray-900/60 text-gray-100 placeholder-gray-400 p-2 rounded focus:ring-2 focus:ring-blue-500",value:g,onChange:e=>A(e.target.value)}),a.jsx("input",{type:"number",placeholder:"Monto máximo",className:"border border-gray-700 bg-gray-900/60 text-gray-100 placeholder-gray-400 p-2 rounded focus:ring-2 focus:ring-blue-500",value:u,onChange:e=>P(e.target.value)})]})}),a.jsxs("div",{className:"flex gap-4 mb-6",children:[a.jsx("button",{onClick:()=>{m(1),w()},className:"bg-gradient-to-r from-blue-600 to-blue-400 hover:from-blue-700 hover:to-blue-500 text-white px-6 py-2 rounded-lg font-semibold shadow-lg transition-all duration-300",children:"🔍 Buscar"}),a.jsx("button",{onClick:R,className:"bg-gradient-to-r from-green-600 to-green-400 hover:from-green-700 hover:to-green-500 text-white px-6 py-2 rounded-lg font-semibold shadow-lg transition-all duration-300",children:"📥 Exportar a Excel"})]}),a.jsx("div",{className:"bg-gray-800/30 backdrop-blur-sm border border-gray-700 rounded-lg overflow-hidden",children:a.jsx("div",{className:"overflow-x-auto",children:B?a.jsx("div",{className:"p-8 text-center",children:a.jsx("div",{className:"text-gray-400 text-lg",children:"Cargando..."})}):a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{children:a.jsx("tr",{className:"bg-gray-700/50 text-left",children:x.map((e,s)=>a.jsx("th",{className:"p-3 font-semibold text-gray-200",children:e},s))})}),a.jsx("tbody",{children:o.length>0?o.map((e,s)=>a.jsx("tr",{className:"border-b border-gray-700/30 hover:bg-gray-700/30 transition-colors",children:x.map((q,L)=>a.jsx("td",{className:"p-3 text-gray-300",children:e[q]?.toString()},L))},s)):a.jsx("tr",{children:a.jsx("td",{colSpan:x.length,className:"text-center p-8 text-gray-500",children:"No hay resultados para mostrar"})})})]})})}),a.jsxs("div",{className:"flex justify-center items-center gap-4 mt-6",children:[a.jsx("button",{onClick:()=>m(e=>Math.max(e-1,1)),className:"bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg text-white transition disabled:opacity-50",disabled:r===1,children:"← Anterior"}),a.jsxs("span",{className:"text-gray-300 font-medium",children:["Página ",r," de ",b," | Total: ",j," registros"]}),a.jsx("button",{onClick:()=>m(e=>Math.min(e+1,b)),className:"bg-gray-700 hover:bg-gray-600 px-4 py-2 rounded-lg text-white transition disabled:opacity-50",disabled:r===b,children:"Siguiente →"})]})]})})}export{V as default};
