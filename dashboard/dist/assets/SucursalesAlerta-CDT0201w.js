import{r as t,A as i,j as e,L as f}from"./index-CtDtNwU0.js";import{a as u}from"./index-NIGUFBhG.js";function w(){const[g,b]=t.useState([]),[h,c]=t.useState(!0),[x,m]=t.useState(null),[d,v]=t.useState(7);t.useEffect(()=>{o()},[]);const o=async()=>{try{c(!0),console.log("üîç Intentando conectar a:",`${i}/sucursales-alerta`);const s=await u.get(`${i}/sucursales-alerta`);console.log("‚úÖ Respuesta recibida:",s.data),b(s.data),m(null)}catch(s){console.error("‚ùå Error al cargar alertas:",s),console.error("üìä Detalles del error:",{message:s.message,status:s.response?.status,statusText:s.response?.statusText,data:s.response?.data});let r="Error al cargar las alertas de sucursales";s.code==="ECONNREFUSED"?r="No se puede conectar al servidor. Verifica que est√© funcionando en el puerto 3000.":s.response?.status===404?r="El endpoint /sucursales-alerta no fue encontrado en el servidor.":s.response?.status>=500&&(r="Error interno del servidor. Revisa los logs del backend."),m(r)}finally{c(!1)}},p=async()=>{try{console.log("üß™ Probando conexi√≥n con endpoint de test...");const s=await u.get(`${i}/sucursales-alerta-test`);console.log("‚úÖ Test exitoso:",s.data),alert(`‚úÖ Conexi√≥n exitosa con el servidor!
Puedes revisar la consola para m√°s detalles.`)}catch(s){console.error("‚ùå Test fall√≥:",s),alert(`‚ùå Error en la conexi√≥n:
`+(s.message||"Error desconocido"))}},j=s=>s>=7?{nivel:"Cr√≠tica",color:"bg-red-500",textColor:"text-red-100"}:s>=5?{nivel:"Alta",color:"bg-orange-500",textColor:"text-orange-100"}:s>=3?{nivel:"Media",color:"bg-yellow-500",textColor:"text-yellow-100"}:{nivel:"Baja",color:"bg-blue-500",textColor:"text-blue-100"},a=g.filter(s=>s.diasSinActividad<=d),l={critica:a.filter(s=>s.diasSinActividad>=7).length,alta:a.filter(s=>s.diasSinActividad>=5&&s.diasSinActividad<7).length,media:a.filter(s=>s.diasSinActividad>=3&&s.diasSinActividad<5).length,baja:a.filter(s=>s.diasSinActividad>=2&&s.diasSinActividad<3).length};return h?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center",children:e.jsx("div",{className:"text-white text-xl",children:"Cargando alertas..."})}):x?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"bg-red-900/20 border border-red-500 rounded-lg p-8 max-w-md",children:[e.jsx("div",{className:"text-red-400 text-xl mb-4",children:"‚ùå Error de Conexi√≥n"}),e.jsx("div",{className:"text-gray-300 mb-6",children:x}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:o,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-medium transition",children:"üîÑ Reintentar"}),e.jsx("button",{onClick:p,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition",children:"üß™ Probar Conexi√≥n"}),e.jsx(f,{to:"/",className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition",children:"üè† Volver al Home"})]}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:["URL: ",i,"/sucursales-alerta"]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"mb-8 flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-400 via-orange-400 to-yellow-400 mb-4",children:"üö® Alertas de Sucursales"}),e.jsx("p",{className:"text-gray-300 text-lg",children:"Monitoreo de sucursales con d√≠as sin cobros de procesadores v√°lidos"})]})}),e.jsxs("div",{className:"mb-6 flex flex-wrap gap-4 items-center",children:[e.jsx("label",{className:"text-white font-medium",children:"Filtrar por d√≠as sin cobro:"}),e.jsxs("select",{value:d,onChange:s=>v(Number(s.target.value)),className:"bg-gray-700 text-white px-4 py-2 rounded-lg border border-gray-600 focus:border-blue-400 focus:outline-none",children:[e.jsx("option",{value:2,children:"2 d√≠as"}),e.jsx("option",{value:3,children:"3 d√≠as"}),e.jsx("option",{value:5,children:"5 d√≠as"}),e.jsx("option",{value:7,children:"7 d√≠as"}),e.jsx("option",{value:15,children:"15 d√≠as"}),e.jsx("option",{value:30,children:"30 d√≠as"})]}),e.jsx("button",{onClick:o,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors",children:"üîÑ Actualizar"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-red-500/20 backdrop-blur-sm border border-red-400/30 rounded-xl p-4",children:[e.jsx("div",{className:"text-red-400 text-sm font-medium",children:"Cr√≠tica (‚â•7 d√≠as)"}),e.jsx("div",{className:"text-red-100 text-2xl font-bold",children:l.critica})]}),e.jsxs("div",{className:"bg-orange-500/20 backdrop-blur-sm border border-orange-400/30 rounded-xl p-4",children:[e.jsx("div",{className:"text-orange-400 text-sm font-medium",children:"Alta (5-6 d√≠as)"}),e.jsx("div",{className:"text-orange-100 text-2xl font-bold",children:l.alta})]}),e.jsxs("div",{className:"bg-yellow-500/20 backdrop-blur-sm border border-yellow-400/30 rounded-xl p-4",children:[e.jsx("div",{className:"text-yellow-400 text-sm font-medium",children:"Media (3-4 d√≠as)"}),e.jsx("div",{className:"text-yellow-100 text-2xl font-bold",children:l.media})]}),e.jsxs("div",{className:"bg-blue-500/20 backdrop-blur-sm border border-blue-400/30 rounded-xl p-4",children:[e.jsx("div",{className:"text-blue-400 text-sm font-medium",children:"Baja (2 d√≠as)"}),e.jsx("div",{className:"text-blue-100 text-2xl font-bold",children:l.baja})]})]}),a.length===0?e.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-xl p-8 text-center",children:e.jsx("div",{className:"text-gray-300 text-xl",children:"‚úÖ No hay sucursales con alertas en el per√≠odo seleccionado"})}):e.jsx("div",{className:"space-y-4",children:a.sort((s,r)=>r.diasSinActividad-s.diasSinActividad).map((s,r)=>{const n=j(s.diasSinActividad);return e.jsx("div",{className:"bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-xl p-6 hover:border-gray-600 transition-colors",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"text-white text-xl font-bold mb-2",children:["üè¢ ",s.Sucursal]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Responsable:"}),e.jsx("span",{className:"text-white ml-2",children:s.nombre_slack})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"√öltimo procesador:"}),e.jsx("span",{className:"text-white ml-2",children:s.ultimo_procesador})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"√öltimo cobro:"}),e.jsx("span",{className:"text-white ml-2",children:new Date(s.ultima_fecha).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"√öltima venta:"}),e.jsx("span",{className:"text-white ml-2",children:s.ultima_venta?new Date(s.ultima_venta).toLocaleDateString():"Sin registro"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"D√≠as sin cobro:"}),e.jsxs("span",{className:"text-white ml-2 font-bold",children:[s.diasSinActividad," d√≠as"]})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("span",{className:`${n.color} ${n.textColor} px-3 py-1 rounded-full text-sm font-bold`,children:n.nivel}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-white text-2xl font-bold",children:s.diasSinActividad}),e.jsx("div",{className:"text-gray-400 text-sm",children:"d√≠as sin cobro"})]})]})]})},`${s.Sucursal}-${r}`)})}),e.jsxs("div",{className:"mt-8 bg-gray-800/30 backdrop-blur-sm border border-gray-700 rounded-xl p-6",children:[e.jsx("h3",{className:"text-white text-lg font-bold mb-2",children:"üìä Resumen"}),e.jsxs("p",{className:"text-gray-300",children:["Total de sucursales con alertas: ",e.jsx("span",{className:"text-white font-bold",children:a.length})]}),e.jsxs("p",{className:"text-gray-300",children:["Filtro actual: Sucursales con ",e.jsxs("span",{className:"text-white font-bold",children:[d," d√≠as o menos"]})," sin cobro"]})]})]})})}export{w as default};
